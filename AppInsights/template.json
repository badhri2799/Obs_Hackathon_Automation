{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "components_Rsliinfra_name": {
            "type": "String",
            "defaultValue": "Rsliinfra"
        },
        "workspaces_DefaultWorkspace_72f8027a_150a_4542_97d9_891a1e2b650f_southind_externalid": {
            "type": "String",
            "defaultValue": "/subscriptions/<subscription_id>/resourceGroups/DefaultResourceGroup-southindia/providers/Microsoft.OperationalInsights/workspaces/DefaultWorkspace-72f8027a-150a-4542-97d9-891a1e2b650f-southind"
        },
        "location": {
            "type": "String",
            "defaultValue": "southindia"
        },
        "emailNotificationEnabled": {
            "type": "Boolean",
            "defaultValue": true
        },
        "emailSubscriptionOwner": {
            "type": "Boolean",
            "defaultValue": true
        },
        "customEmails": {
            "type": "Array",
            "defaultValue": []
        },
        "rules": {
            "type": "Array",
            "defaultValue": [
                {
                    "Name": "degradationindependencyduration",
                    "DisplayName": "Degradation in dependency duration",
                    "Description": "Smart Detection rules notify you of performance anomaly issues.",
                    "HelpUrl": "https://docs.microsoft.com/en-us/azure/application-insights/app-insights-proactive-performance-diagnostics",
                    "Enabled": true
                },
                {
                    "Name": "degradationinserverresponsetime",
                    "DisplayName": "Degradation in server response time",
                    "Description": "Smart Detection rules notify you of performance anomaly issues.",
                    "HelpUrl": "https://docs.microsoft.com/en-us/azure/application-insights/app-insights-proactive-performance-diagnostics",
                    "Enabled": true
                },
                {
                    "Name": "digestMailConfiguration",
                    "DisplayName": "Digest Mail Configuration",
                    "Description": "This rule describes the digest mail preferences",
                    "HelpUrl": "www.homail.com",
                    "Enabled": true
                }
            ]
        }
    },
    "variables": {},
    "resources": [
        {
            "type": "microsoft.insights/components",
            "apiVersion": "2020-02-02",
            "name": "[parameters('components_Rsliinfra_name')]",
            "location": "[parameters('location')]",
            "tags": {
                "VM": "Rsliinfra"
            },
            "kind": "web",
            "properties": {
                "Application_Type": "web",
                "Flow_Type": "Redfield",
                "Request_Source": "IbizaAIExtension",
                "RetentionInDays": 90,
                "WorkspaceResourceId": "[parameters('workspaces_DefaultWorkspace_72f8027a_150a_4542_97d9_891a1e2b650f_southind_externalid')]",
                "IngestionMode": "LogAnalytics",
                "publicNetworkAccessForIngestion": "Enabled",
                "publicNetworkAccessForQuery": "Enabled"
            }
        },
        {
            "type": "microsoft.insights/components/ProactiveDetectionConfigs",
            "apiVersion": "2018-05-01-preview",
            "name": "[concat(parameters('components_Rsliinfra_name'), '/degradationindependencyduration')]",
            "location": "[parameters('location')]",
            "dependsOn": [
                "[resourceId('microsoft.insights/components', parameters('components_Rsliinfra_name'))]"
            ],
            "properties": {
                "ruleDefinitions": "[first(where(parameters('rules'), item().Name == 'degradationindependencyduration'))]",
                "enabled": "[parameters('emailNotificationEnabled')]",
                "sendEmailsToSubscriptionOwners": "[parameters('emailSubscriptionOwner')]",
                "customEmails": "[parameters('customEmails')]"
            }
        },
        {
            "type": "microsoft.insights/components/ProactiveDetectionConfigs",
            "apiVersion": "2018-05-01-preview",
            "name": "[concat(parameters('components_Rsliinfra_name'), '/degradationinserverresponsetime')]",
            "location": "[parameters('location')]",
            "dependsOn": [
                "[resourceId('microsoft.insights/components', parameters('components_Rsliinfra_name'))]"
            ],
            "properties": {
                "ruleDefinitions": "[first(where(parameters('rules'), item().Name == 'degradationinserverresponsetime'))]",
                "enabled": "[parameters('emailNotificationEnabled')]",
                "sendEmailsToSubscriptionOwners": "[parameters('emailSubscriptionOwner')]",
                "customEmails": "[parameters('customEmails')]"
            }
        },
        {
            "type": "microsoft.insights/components/ProactiveDetectionConfigs",
            "apiVersion": "2018-05-01-preview",
            "name": "[concat(parameters('components_Rsliinfra_name'), '/digestMailConfiguration')]",
            "location": "[parameters('location')]",
            "dependsOn": [
                "[resourceId('microsoft.insights/components', parameters('components_Rsliinfra_name'))]"
            ],
            "properties": {
                "ruleDefinitions": "[first(where(parameters('rules'), item().Name == 'digestMailConfiguration'))]",
                "enabled": "[parameters('emailNotificationEnabled')]",
                "sendEmailsToSubscriptionOwners": "[parameters('emailSubscriptionOwner')]",
                "customEmails": "[parameters('customEmails')]"
            }
        }
    ]
}
